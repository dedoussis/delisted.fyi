<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Delisted?</title>
    <meta name="keywords" content="delisted,nyse,finance,stocks" />
 
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Acme&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="styles.css">

    <script defer data-domain="delisted.fyi" src="https://plausible.io/js/plausible.js"></script>
</head>

<body>
    <div class="center content">
        <h1 id="title">Please select a valid symbol! âš ï¸</h1>
        <h2 class="x-highlighted" id="isDelisted"></h2>
        <h3>30 trading-day closing average: <span class="highlighted" id="closingAvg">Boo!</span></h2>
        <h3>Based on last month's performance the stock is predicted to go delisted in <span class="highlighted" id="daysUntilDelisting">Argh!</span> trading days.</h2>
        <h4>Last updated at <span class="highlighted">{{ updated_at }}</span></h3>
    </div>

    <script>
        const params = new Proxy(new URLSearchParams(window.location.search), {
            get: (searchParams, prop) => searchParams.get(prop),
        });
        let symbol = params.symbol && params.symbol.toLowerCase();
        let data = {{ json_data }};
        const emojis = ["ğŸ†", "ğŸ’™", "âš½", "ğŸ„â€â™‚ï¸", "ğŸ¨", "ğŸï¸", "ğŸª„"];
        const random = Math.floor(Math.random() * emojis.length);

        if (symbol && Object.keys(data).includes(symbol)) {
            document.getElementById("title").innerHTML = "Is " + symbol.toUpperCase() + " delisted yet? <span role=\"img\" aria-label=\"random-emoji\">" + emojis[random] + "</span>";
            document.getElementById("closingAvg").innerHTML=data[symbol].closingAvg;
            document.getElementById("daysUntilDelisting").innerHTML=data[symbol].daysUntilDelisting;
            document.getElementById("isDelisted").innerHTML=data[symbol].isDelisted? "YES": "NO"; 
        }
    </script>
</body>

</html>
